<%- include("layout.html") %>

<h2 class="text-2xl font-bold mb-6">ðŸ‘¥ Suscriptores Detallados</h2>

<form method="GET" class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-6">

  <input type="hidden" name="t" value="<%= token %>">

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

    <!-- Plan -->
    <div>
      <label class="text-sm">Plan</label>
      <select name="plan" class="w-full p-2 bg-slate-900 border border-slate-700 rounded">
        <option value="">Todos</option>
        <% plans.forEach(p => { %>
          <option value="<%= p.name %>" <%= filter.plan === p.name ? "selected" : "" %>>
            <%= p.name %>
          </option>
        <% }) %>
      </select>
    </div>

    <!-- Estado -->
    <div>
      <label class="text-sm">Estado</label>
      <select name="state" class="w-full p-2 bg-slate-900 border border-slate-700 rounded">
        <option value="">Todos</option>
        <option value="active" <%= filter.state === "active" ? "selected" : "" %>>Activos</option>
        <option value="expired" <%= filter.state === "expired" ? "selected" : "" %>>Expirados</option>
      </select>
    </div>

    <!-- MÃ©todo de pago -->
    <div>
      <label class="text-sm">MÃ©todo de pago</label>
      <select name="method" class="w-full p-2 bg-slate-900 border border-slate-700 rounded">
        <option value="">Todos</option>
        <option value="Stripe" <%= filter.method === "Stripe" ? "selected" : "" %>>Stripe</option>
        <option value="TON" <%= filter.method === "TON" ? "selected" : "" %>>TON</option>
      </select>
    </div>

  </div>

  <button class="mt-4 px-4 py-2 bg-emerald-500 text-slate-900 rounded font-semibold">
    Filtrar
  </button>

</form>

<table class="w-full text-left border-collapse">
  <thead class="bg-slate-700 text-slate-300">
    <tr>
      <th class="p-3">Usuario</th>
      <th class="p-3">Plan</th>
      <th class="p-3">Estado</th>
      <th class="p-3">MÃ©todo</th>
      <th class="p-3">Fin</th>
    </tr>
  </thead>
  <tbody>

  <% subs.forEach(s => { %>
    <tr class="border-b border-slate-700">
      <td class="p-3"><%= s.userId %></td>
      <td class="p-3"><%= s.planName %></td>
      <td class="p-3">
        <% if (s.active) { %>
          <span class="text-green-400">Activo</span>
        <% } else { %>
          <span class="text-red-400">Expirado</span>
        <% } %>
      </td>
      <td class="p-3"><%= s.paymentMethod || "N/A" %></td>
      <td class="p-3"><%= new Date(s.endAt).toLocaleString() %></td>
    </tr>
  <% }) %>

  </tbody>
</table>
